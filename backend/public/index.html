<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripShare - Centro de Comando</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; font-family: 'Inter', sans-serif; background: #1a1a1a; color: white; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        #painel {
            position: absolute; top: 20px; right: 20px; width: 350px;
            background: rgba(0, 0, 0, 0.85); padding: 20px; border-radius: 12px;
            z-index: 999; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid #333; backdrop-filter: blur(5px);
        }
        h1 { margin: 0 0 10px 0; font-size: 20px; color: #a388ee; }
        .status { font-size: 12px; color: #00ff88; margin-bottom: 15px; display: block; }
        .card-corrida {
            background: #2a2a2a; padding: 15px; border-radius: 8px;
            border-left: 4px solid #a388ee; margin-top: 10px;
            animation: slideIn 0.5s ease;
        }
        .valor { font-size: 24px; font-weight: bold; color: white; }
        .detalhe { color: #aaa; font-size: 14px; margin-top: 5px; }
        @keyframes slideIn { from { transform: translateX(50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>
    <div id="painel">
        <h1>üöÅ TripShare Ops</h1>
        <span class="status">‚óè Sistema Online (WebSocket)</span>
        <div id="lista-corridas">
            <div style="color: #666; text-align: center; padding: 20px;">Aguardando solicita√ß√µes...</div>
        </div>
    </div>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const map = L.map('map').setView([-1.455, -48.49], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);
        let rotaAtual = null;
        const socket = io();

        socket.on('connect', () => {
            console.log("Conectado ao servidor!");
            socket.emit('entrar_como_motorista', { id_motorista: 'ADMIN_PANEL' });
        });

        socket.on('alerta_corrida', (dados) => {
            adicionarCorridaNaTela(dados);
            if(dados.geometria) desenharRota(dados.geometria);
        });

        function adicionarCorridaNaTela(dados) {
            const lista = document.getElementById('lista-corridas');
            if(lista.innerText.includes('Aguardando')) lista.innerHTML = '';
            const card = document.createElement('div');
            card.className = 'card-corrida';
            card.innerHTML = `<div class="valor">R$ ${dados.valor.toFixed(2)}</div><div class="detalhe">üìè ${dados.distancia} ‚Ä¢ ‚è±Ô∏è ${dados.tempo}</div><div class="detalhe" style="font-size: 10px; margin-top:5px; color:#666">ID: #${dados.id_corrida}</div>`;
            lista.prepend(card);
        }

        function desenharRota(geojson) {
            if (rotaAtual) map.removeLayer(rotaAtual);
            rotaAtual = L.geoJSON(geojson, { style: { color: '#00ff88', weight: 5, opacity: 0.7 } }).addTo(map);
            map.fitBounds(rotaAtual.getBounds(), { padding: [50, 50] });
        }
    </script>
</body>
</html>